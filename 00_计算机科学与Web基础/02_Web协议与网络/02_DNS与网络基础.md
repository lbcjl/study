# 02. DNS ä¸ç½‘ç»œåŸºç¡€ - äº’è”ç½‘é€šè®¯å½•

å‡å¦‚ä½ è¦ç»™ä½ çš„æœ‹å‹â€œå¼ ä¸‰â€æ‰“ç”µè¯ï¼Œä½ ä¼šç›´æ¥èƒŒä¸‹æ¥ä»–çš„æ‰‹æœºå· `138-1234-5678` å—ï¼Ÿ
é€šå¸¸ä¸ä¼šã€‚ä½ ä¼šæ‰“å¼€é€šè®¯å½•ï¼Œæœç´¢â€œå¼ ä¸‰â€ï¼Œç„¶åç‚¹å‡»æ‹¨å·ã€‚

**DNS (Domain Name System)** å°±æ˜¯äº’è”ç½‘çš„é€šè®¯å½•ã€‚

## ğŸ› ï¸ å‡†å¤‡å·¥ä½œï¼šè¿è¡Œç¯å¢ƒ

æœ¬èŠ‚æ¶‰åŠ `curl` å’Œ `nslookup` å‘½ä»¤ã€‚

1.  **Windows ç”¨æˆ·**: æ¨èä½¿ç”¨ **Git Bash**ã€‚
    - å¦‚æœä½¿ç”¨é»˜è®¤ CMDï¼Œ`nslookup` å¯ä»¥æ­£å¸¸å·¥ä½œã€‚
    - ä½† `curl` å¯èƒ½é‡åˆ°å¼•å·è½¬ä¹‰é—®é¢˜ï¼Œä¸”æ²¡æœ‰ `dig` å‘½ä»¤ã€‚
2.  **Mac/Linux ç”¨æˆ·**: ç›´æ¥ä½¿ç”¨ç»ˆç«¯å³å¯ã€‚

---

---

## ğŸ­ åœºæ™¯ä¸€ï¼šå¯»æ‰¾â€œè°·æ­Œä¹‹å®¶â€ (DNS Resolution)

åœ¨æµè§ˆå™¨è¾“å…¥ `www.google.com` å¹¶å›è½¦æ—¶ï¼Œå‘ç”Ÿäº†ä¸€åœºè·¨è¶Šå…¨çƒçš„æ¥åŠ›èµ›ã€‚

### 1. æœ¬åœ°é€šè®¯å½• (Browser & System Cache)

- **æµè§ˆå™¨**ï¼šâ€œç­‰ç­‰ï¼Œæˆ‘ 5 åˆ†é’Ÿå‰åˆšå»è¿‡ï¼Œæˆ‘è®°å¾—åœ°å€æ˜¯ `142.250.190.46`ã€‚â€ï¼ˆç›´æ¥å‘½ä¸­ï¼Œé€Ÿåº¦ 0msï¼‰ã€‚
- **ç³»ç»Ÿ (`/etc/hosts`)**ï¼šâ€œæˆ‘ä¹Ÿçœ‹çœ‹æˆ‘çš„å°æœ¬æœ¬...æ²¡è®°ã€‚â€

### 2. å°åŒºç‰©ä¸š (ISP DNS)

å¦‚æœç”µè„‘ä¸çŸ¥é“ï¼Œå®ƒä¼šé—®ä½ å®¶å®½å¸¦è¿è¥å•†ï¼ˆç”µä¿¡/è”é€šï¼‰çš„ DNS æœåŠ¡å™¨ã€‚

- **ISP DNS**ï¼šâ€œæˆ‘æŸ¥æŸ¥ç¼“å­˜...ä¹Ÿæ²¡æœ‰ã€‚ä½†æˆ‘çŸ¥é“è°ç®¡è¿™äº‹ã€‚â€

### 3. å…¨çƒæ¥åŠ› (Recursive Query)

- **æ ¹æœåŠ¡å™¨ (.)**ï¼šâ€œæˆ‘ä¸è®°å…·ä½“åœ°å€ï¼Œä½†æˆ‘çŸ¥é“ `.com` å½’è°ç®¡ï¼Œå»æ‰¾ `.com` é¡¶çº§åŸŸæœåŠ¡å™¨ã€‚â€
- **é¡¶çº§åŸŸ (.com)**ï¼šâ€œæˆ‘ä¸è®° `google.com`ï¼Œä½†æˆ‘çŸ¥é“å®ƒå½’ `ns1.google.com` ç®¡ï¼Œä½ å»é—®å®ƒã€‚â€
- **æƒå¨æœåŠ¡å™¨ (ns1.google.com)**ï¼šâ€œæ‰¾åˆ°äº†ï¼`www.google.com` çš„ IP æ˜¯ `142.250.190.46`ã€‚â€

### 4. æ‹¿åˆ°ç»“æœ

æµè§ˆå™¨æ‹¿åˆ°äº† IPï¼Œç»ˆäºå¯ä»¥å»ºç«‹ TCP è¿æ¥ï¼Œå‘é€ HTTP è¯·æ±‚äº†ã€‚

---

## ğŸ­ åœºæ™¯äºŒï¼šIP åœ°å€çš„ç§˜å¯† (localhost vs 127.0.0.1)

ç»å¸¸æœ‰æ–°æ‰‹ææ··è¿™ä¸‰ä¸ªæ¦‚å¿µï¼š

1.  **`127.0.0.1` (ç¯å›åœ°å€)**

    - **æ¯”å–»**: è¿™æ˜¯ä¸€ä¸ª**æ­»èƒ¡åŒ**ã€‚å½“ä½ å‘æ•°æ®ç»™è¿™ä¸ª IPï¼Œç½‘å¡æ ¹æœ¬ä¸ä¼šæŠŠæ•°æ®å‘åˆ°ç½‘çº¿ä¸Šå»ï¼Œè€Œæ˜¯åŸåœ°æ‰å¤´è½¬ç»™è‡ªå·±ã€‚
    - **ä½œç”¨**: æµ‹è¯•æœ¬æœºçš„æœåŠ¡ï¼ˆæ¯”å¦‚ä½ å¯åŠ¨çš„ `localhost:8080`ï¼‰ã€‚

2.  **`0.0.0.0` (ä»»æ„åœ°å€)**

    - **æ¯”å–»**: è¿™æ˜¯ä¸€ä¸ª**å¹¿æ’­ç«™**ã€‚
    - **åœºæ™¯**: å½“ä½ çš„ Go/Node æœåŠ¡å™¨ç›‘å¬ `0.0.0.0:8080` æ—¶ï¼Œæ„å‘³ç€ï¼šâ€œä¸ç®¡ä½ æ˜¯ä»æœ¬æœºè®¿é—®ï¼Œè¿˜æ˜¯ä»å±€åŸŸç½‘ï¼ˆåŒäº‹ç”µè„‘ï¼‰è®¿é—®ï¼Œè¿˜æ˜¯ä»å…¬ç½‘è®¿é—®ï¼Œæˆ‘å…¨æ¥å•ã€‚â€
    - **å‘ç‚¹**: å¦‚æœä½ åªç›‘å¬ `127.0.0.1:8080`ï¼Œé‚£ä½ åŒäº‹å°±è®¿é—®ä¸äº†ä½ çš„æœåŠ¡äº†ã€‚

3.  **`localhost` (åŸŸå)**
    - **æœ¬è´¨**: å®ƒåªæ˜¯ä¸€ä¸ª**æ˜µç§°**ï¼Œä¸æ˜¯ IPã€‚
    - **å¹•åæœºåˆ¶**: ä½ çš„ç”µè„‘é‡Œæœ‰ä¸€ä¸ªâ€œç§å¯†å°æœ¬æœ¬â€ï¼ˆHosts æ–‡ä»¶ï¼‰ã€‚
      - é»˜è®¤åªå†™äº†ä¸€è¡Œï¼š`127.0.0.1 localhost`ï¼ˆæŠŠâ€œlocalhostâ€è§£æä¸ºæœ¬æœºï¼‰ã€‚
      - **æ¶ä½œå‰§**: å¦‚æœä½ åœ¨ Hosts æ–‡ä»¶é‡Œå†™ `220.181.38.148 localhost`ï¼Œå½“ä½ è®¿é—® localhost æ—¶ï¼Œç”µè„‘å°±ä¼šçœŸçš„å¸¦ä½ å»ç™¾åº¦ï¼ˆç™¾åº¦çš„ IPï¼‰ã€‚
    - **ç»“è®º**: `localhost` é»˜è®¤ç­‰äº `127.0.0.1`ï¼Œä½†è¿™åªæ˜¯å› ä¸ºç³»ç»Ÿé»˜è®¤é…ç½®æ˜¯è¿™æ ·ã€‚

---

## ğŸ› ï¸ å®æˆ˜è°ƒè¯•æŠ€å·§

### 1. çœ‹çœ‹æˆ‘çš„ IP æ˜¯ä»€ä¹ˆ

- **å†…ç½‘ IP**: `ipconfig` (Windows) æˆ– `ifconfig` (Mac/Linux)ã€‚
- **å…¬ç½‘ IP**: `curl ifconfig.me`ã€‚è¿™æ˜¯å…¨ä¸–ç•Œéƒ½èƒ½çœ‹åˆ°çš„é‚£ä¸ª IPã€‚

### 2. DNS æŒ–åŸ (`nslookup` / `dig`)

æƒ³çŸ¥é“ `baidu.com` èƒŒååˆ°åº•æœ‰å¤šå°‘ä¸ª IPï¼Ÿ

```bash
nslookup baidu.com

# è¾“å‡º:
# Name:    baidu.com
# Addresses: 220.181.38.148, 220.181.38.251
```

è¿™è¯´æ˜ç™¾åº¦ç”¨äº†**è´Ÿè½½å‡è¡¡**ï¼ŒåŒä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ª IPï¼Œè°æœ‰ç©ºè°æ¥å®¢ã€‚

> **â“ ä¸ºä»€ä¹ˆæˆ‘åªçœ‹åˆ°äº†ä¸€ä¸ª IPï¼Ÿ**
>
> 1.  **ä»£ç†è½¯ä»¶å½±å“**: å¦‚æœä½ çœ‹åˆ°çš„ IP æ˜¯ `198.18.x.x` (å¦‚ `198.18.1.54`)ï¼Œè¯´æ˜ä½ å¼€å¯äº†ä»£ç†è½¯ä»¶ï¼ˆå¦‚ Clashï¼‰ã€‚è¿™æ˜¯å®ƒä¼ªé€ çš„è™šæ‹Ÿ IP (Fake IP)ï¼Œä¸ºäº†æ¥ç®¡æµé‡ã€‚æ­¤æ—¶ä½ çœ‹ä¸åˆ°çœŸå®çš„è´Ÿè½½å‡è¡¡ã€‚
> 2.  **æ™ºèƒ½è°ƒåº¦**: æœ‰äº› DNS æœåŠ¡å™¨æ¯”è¾ƒâ€œé«˜å†·â€ï¼Œæ¯æ¬¡åªç»™ä½ å®ƒè®¤ä¸ºæœ€å¿«çš„é‚£ä¸€ä¸ª IPï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰ IP éƒ½æ‰”ç»™ä½ ã€‚
>
> **â“ å…³æ‰ä»£ç†å DNS è¶…æ—¶æ€ä¹ˆåŠï¼Ÿ**
>
> è¿™æ˜¯ä¸€ä¸ªç»å…¸å‘ï¼šå¾ˆå¤šä»£ç†è½¯ä»¶å…³é—­æ—¶ï¼Œæ²¡æœ‰æŠŠç³»ç»Ÿ DNS è®¾ç½®æ”¹å›å»ï¼Œå¯¼è‡´ä½ çš„ç”µè„‘è¿˜åœ¨å‚»å‚»åœ°é—®ä¸€ä¸ªå·²ç»å…³æ‰çš„ä»£ç†æœåŠ¡å™¨ï¼Œç»“æœå°±æ˜¯ `DNS request timed out`ã€‚
> **è§£å†³æ–¹æ³•**ï¼šæŒ‡å®šä¸€ä¸ªå…¬ç½‘ DNSï¼ˆå¦‚é˜¿é‡Œ DNSï¼‰æ¥æŸ¥ï¼š
>
> ```bash
> nslookup baidu.com 223.5.5.5
> ```
>
> è¿™æ ·ä½ åº”è¯¥å°±èƒ½çœ‹åˆ°çœŸå®çš„å¤šä¸ªå…¬ç½‘ IP äº†ã€‚

---

> ğŸ’¡ **æ ¸å¿ƒæœ€ä½³å®è·µ**
>
> 1.  **TTL (Time To Live)**: DNS æ˜¯æœ‰ç¼“å­˜æ—¶é—´çš„ã€‚å¦‚æœä½ æ¢äº†æœåŠ¡å™¨ IPï¼Œç”¨æˆ·å¯èƒ½è¦ç­‰ TTL è¿‡æœŸï¼ˆæ¯”å¦‚ 10 åˆ†é’Ÿç”šè‡³ 24 å°æ—¶ï¼‰æ‰èƒ½è®¿é—®åˆ°æ–° IPã€‚**åˆ‡åº“å‰è®°å¾—æŠŠ TTL è°ƒçŸ­**ã€‚
> 2.  **Hosts æ–‡ä»¶**: å¼€å‘æ—¶æƒ³åœ¨æœ¬åœ°æµ‹è¯• `api.my-pro-site.com`ï¼Ÿä¸ç”¨ä¹°åŸŸåï¼Œç›´æ¥ä¿®æ”¹æœ¬æœºçš„ `/etc/hosts` (Windows åœ¨ `C:\Windows\System32\drivers\etc\hosts`)ï¼ŒåŠ ä¸Šä¸€è¡Œ `127.0.0.1 api.my-pro-site.com` å³å¯ã€‚è¿™æ˜¯éª—è¿‡æµè§ˆå™¨çš„æœ€å¿«æ–¹æ³•ã€‚
