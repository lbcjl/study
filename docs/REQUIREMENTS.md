# TravelGenie - 旅游规划智能体需求文档

> **项目代号**: TravelGenie ✈️  
> **技术栈**: React 18 + NestJS 10 + 阿里通义千问 + 高德地图  
> **UI 风格**: 清新旅行风 🌿

---

## 📋 当前 Sprint / 活跃任务

### Phase 1: 项目基础搭建 (进行中)

- [ ] 初始化前端项目 (Vite + React + TypeScript)
- [ ] 初始化后端项目 (NestJS + Prisma)
- [ ] 配置 Tailwind CSS 及设计系统
- [ ] 创建基础 UI 组件库 (Button, Input, Card)
- [ ] 配置路由结构
- [ ] 搭建 NestJS 模块架构 (auth, trip, ai, map)

### Phase 2: AI 对话功能 (待开始)

- [ ] 接入阿里通义千问 API
- [ ] 实现 SSE 流式响应
- [ ] 创建聊天 UI 组件 (ChatBox, MessageBubble)
- [ ] 实现打字机效果动画
- [ ] 优化 Prompt 工程 (旅游规划师角色设定)
- [ ] 实现多轮对话上下文管理

### Phase 3: 智能行程规划引擎 (待开始)

- [ ] 集成高德地图 POI 搜索 API
- [ ] 实现景点数据获取与缓存
- [ ] 开发行程优化算法 (基于距离和时间)
- [ ] 实现每日行程自动拆分逻辑
- [ ] 创建行程展示卡片组件

### Phase 4: 推荐系统 (待开始)

- [ ] 酒店推荐模块 (携程 API 或 Mock 数据)
- [ ] 景点推荐模块 (按评分/热度排序)
- [ ] 美食推荐模块 (大众点评 API 或 Mock 数据)
- [ ] 推荐卡片 UI 组件 (支持滑动切换)

### Phase 5: 费用预算计算 (待开始)

- [ ] 费用分类统计逻辑 (交通/住宿/餐饮/门票)
- [ ] 费用可视化组件 (饼图/柱状图)
- [ ] 预算超支提醒与优化建议算法

### Phase 6: 路线地图可视化 (待开始)

- [ ] 高德地图 JS API 集成
- [ ] 景点标记与分类显示
- [ ] 路径绘制与动画效果
- [ ] 地图交互功能 (点击查看详情)

---

## 🎯 核心功能需求

### 1️⃣ AI 对话式交互

**目标**: 用户通过自然语言描述需求，AI 智能生成旅行方案

**输入参数**:

- 目的地 (城市)
- 旅行天数 (1-15 天)
- 预算范围 (元)
- 兴趣标签 (美食/摄影/历史/自然/亲子等)
- 出行人数
- 出行方式 (自驾/公共交通)

**技术实现**:

- 使用阿里通义千问 API (`qwen-max` 或 `qwen-turbo`)
- SSE 流式输出，前端实时渲染
- Prompt 工程：角色设定为专业旅游规划师
- 上下文管理：多轮对话保持连贯性

---

### 2️⃣ 智能行程规划

**目标**: 根据天数自动拆分每日行程，优化游览顺序

**输出内容**:

- 每日时间轴 (早中晚 + 交通时间)
- 景点信息 (门票/开放时间/游玩耗时)
- 餐饮建议 (推荐餐厅/人均消费)
- 交通方案 (距离/耗时/方式)

**算法要点**:

- 基于景点间距离优化路线 (避免折返)
- 预留用餐、休息时间
- 考虑景点开放时间

---

### 3️⃣ 酒店/景点/美食推荐

**数据来源**:

- 高德地图 API (POI 搜索)
- 携程 API (酒店价格/评价)
- 大众点评 API (美食评分)
- **备选**: Mock 数据或公开数据集

**展示形式**:

- 卡片式布局 (可左右滑动)
- 显示评分、价格、位置、特色标签
- 一键添加到行程

---

### 4️⃣ 费用预算计算

**分类统计**:

- 交通费 (往返大交通 + 市内交通)
- 住宿费 (按天数 × 每晚价格)
- 餐饮费 (早中晚餐预算)
- 门票费 (所有景点汇总)
- 其他费用 (预留 10%)

**优化建议**:

- 超支时提供降级方案 (如更换酒店档次)

---

### 5️⃣ 路径路线图

**功能**:

- 在地图上标注所有景点位置
- 绘制游览路线 + 方向箭头
- 显示距离和交通方式
- 支持 2D/3D 切换
- 路径动画演示

**技术**:

- 高德地图 JS API
- 不同颜色标记 (景点/餐厅/酒店)

---

## 🛠️ 技术上下文参考

详细技术栈、架构设计、数据库 Schema 请查看 [`docs/TECH_CONTEXT.md`](./TECH_CONTEXT.md)

---

## 📦 数据依赖

### API Keys 需要准备

- [x] 阿里通义千问 API Key
- [x] 高德地图 Web 服务 API Key
- [ ] 携程 API Key (或使用 Mock 数据)
- [ ] 大众点评 API Key (或使用 Mock 数据)

### 环境变量配置

```env
# 后端 .env
QWEN_API_KEY=sk-xxxx
AMAP_API_KEY=xxxx
DATABASE_URL=postgresql://user:pass@localhost:5432/travelgenie
REDIS_URL=redis://localhost:6379

# 前端 .env
VITE_AMAP_KEY=xxxx
VITE_API_BASE_URL=http://localhost:3001
```

---

## 🚀 里程碑计划

| 阶段                | 预计耗时   | 交付物                          |
| ------------------- | ---------- | ------------------------------- |
| Phase 1: 基础搭建   | 2 周       | 可运行的前后端框架 + 基础组件   |
| Phase 2: AI 对话    | 1 周       | 能正常对话并解析需求的聊天界面  |
| Phase 3: 行程规划   | 2 周       | 能生成完整行程的引擎 + 展示页面 |
| Phase 4: 推荐系统   | 1 周       | 景点/酒店/美食推荐卡片          |
| Phase 5: 费用计算   | 1 周       | 费用明细 + 可视化图表           |
| Phase 6: 地图可视化 | 1 周       | 路线地图 + 动画演示             |
| **MVP 总计**        | **7-8 周** | 完整可用的旅游规划智能体        |

---

## ⚠️ 已知风险 & 备选方案

| 风险                       | 影响 | 备选方案                           |
| -------------------------- | ---- | ---------------------------------- |
| 携程/大众点评 API 无法获取 | 高   | 使用公开数据集或 Mock 数据         |
| 通义千问 API 成本过高      | 中   | 切换到开源模型 (Qwen-14B 本地部署) |
| 高德地图配额不足           | 低   | 使用缓存策略减少调用               |

---

## 📝 待确认事项

> [!WARNING]  
> **以下问题需要在开发前明确**

1. **后端技术栈确认**: 使用 NestJS 还是 Go (Gin)?
   - 建议: NestJS (全栈 TypeScript 统一，快速迭代)
2. **用户系统**: 是否需要登录/注册功能? 还是匿名使用?
   - 建议: MVP 阶段使用本地存储，暂不做登录
3. **数据持久化**: 行程是否需要保存到数据库? 还是仅本地存储?
   - 建议: 先用浏览器 localStorage，后期再加数据库
4. **导出功能**: 是否需要在 MVP 阶段实现行程导出 (PDF/图片)?
   - 建议: MVP 阶段先不做，优先保证核心功能

---

## 🎉 已完成功能

- [x] 需求分析与技术选型
- [x] PRD 文档编写
- [x] 项目目录规划
